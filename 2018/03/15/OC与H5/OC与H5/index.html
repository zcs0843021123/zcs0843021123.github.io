<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="iOS," />










<meta name="description" content="零. 写在前边的话 本系列文章是自己的学习总结,因此写的有些简略,如有任何问题,可以给我发邮件, 我的邮箱 1017295148@qq.com 参考链接: https://www.jianshu.com/p/fd378c6d70c0  一. UIWebView常用OC语js交互  利用WKWebView进行交互(系统API) 利用UIWebView进行交互(系统API) 苹果的JavaScript">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="OC与H5">
<meta property="og:url" content="https://zcs0843021123.github.io/2018/03/15/OC与H5/OC与H5/index.html">
<meta property="og:site_name" content="凤凰苑">
<meta property="og:description" content="零. 写在前边的话 本系列文章是自己的学习总结,因此写的有些简略,如有任何问题,可以给我发邮件, 我的邮箱 1017295148@qq.com 参考链接: https://www.jianshu.com/p/fd378c6d70c0  一. UIWebView常用OC语js交互  利用WKWebView进行交互(系统API) 利用UIWebView进行交互(系统API) 苹果的JavaScript">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-05-12T11:34:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OC与H5">
<meta name="twitter:description" content="零. 写在前边的话 本系列文章是自己的学习总结,因此写的有些简略,如有任何问题,可以给我发邮件, 我的邮箱 1017295148@qq.com 参考链接: https://www.jianshu.com/p/fd378c6d70c0  一. UIWebView常用OC语js交互  利用WKWebView进行交互(系统API) 利用UIWebView进行交互(系统API) 苹果的JavaScript">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"right","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zcs0843021123.github.io/2018/03/15/OC与H5/OC与H5/"/>





  <title>OC与H5 | 凤凰苑</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">凤凰苑</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">张春生的个人博客</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zcs0843021123.github.io/2018/03/15/OC与H5/OC与H5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张春生">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/12196768?s=400&u=8427ff12e9cdf05f9659b444385b2b5ee1663a18&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凤凰苑">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">OC与H5</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-15T21:15:31+08:00">
                2018-03-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="零-写在前边的话"><a href="#零-写在前边的话" class="headerlink" title="零. 写在前边的话"></a>零. 写在前边的话</h1><ol>
<li>本系列文章是自己的学习总结,因此写的有些简略,如有任何问题,可以给我发邮件, 我的邮箱 <a href="mailto:1017295148@qq.com" target="_blank" rel="noopener">1017295148@qq.com</a></li>
<li>参考链接: <a href="https://www.jianshu.com/p/fd378c6d70c0" target="_blank" rel="noopener">https://www.jianshu.com/p/fd378c6d70c0</a></li>
</ol>
<h1 id="一-UIWebView"><a href="#一-UIWebView" class="headerlink" title="一. UIWebView"></a>一. UIWebView</h1><p>常用OC语js交互</p>
<ul>
<li>利用WKWebView进行交互(系统API)</li>
<li>利用UIWebView进行交互(系统API)</li>
<li>苹果的JavaScriptCore.framework框架; </li>
<li>跨平台cordova框架;</li>
<li>oc第三方WebViewJavascriptBridge</li>
</ul>
<h2 id="1-执行js语句"><a href="#1-执行js语句" class="headerlink" title="1. 执行js语句"></a>1. 执行js语句</h2><p>所有js可以做的在这里都可以做<br>如修改页面、提交表单、获取当前页面的url（document.location.href）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [superviewDidLoad];</span><br><span class="line">    NSURL*url = [[NSBundlemainBundle]URLForResource:@&quot;index&quot;withExtension:@&quot;html&quot;];</span><br><span class="line">    NSURLRequest *request = [NSURLRequestrequestWithURL:url];</span><br><span class="line">    [self.webViewloadRequest:request];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (void)webViewDidFinishLoad:(nonnullUIWebView*)webView &#123;</span><br><span class="line">    </span><br><span class="line">    //当加载完成的时候就可以修改 html 的内容</span><br><span class="line">    //比如获取 img,p,button 等标签</span><br><span class="line">    NSString*str = @&quot;var img = document.getElementsByTagName(&apos;img&apos;)[0];&quot;;</span><br><span class="line">    //增删改查等</span><br><span class="line">    NSString*str1 = @&quot;img.remove();&quot;;</span><br><span class="line"></span><br><span class="line">    //最主要的方法,通过此方法,就可以修改加载的页面啦</span><br><span class="line">    [webViewstringByEvaluatingJavaScriptFromString:str];</span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:str1];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-shouldStartLoadWithRequest-访问原生"><a href="#2-shouldStartLoadWithRequest-访问原生" class="headerlink" title="2. shouldStartLoadWithRequest 访问原生"></a>2. shouldStartLoadWithRequest 访问原生</h2><p>如：调用系统资源，比如相册，相机等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">     &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">      &lt;button onclick=&quot;btnClick();&quot;&gt;访问相册&lt;/button&gt;</span><br><span class="line">     &lt;script&gt;</span><br><span class="line">          function btnClick()&#123;</span><br><span class="line">             window.location.href =&apos;zcs://btnClick&apos;;</span><br><span class="line">          &#125;</span><br><span class="line">     &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [superviewDidLoad];</span><br><span class="line"></span><br><span class="line">    NSURL *url = [[NSBundlemainBundle]URLForResource:@&quot;index&quot;withExtension:@&quot;html&quot;];</span><br><span class="line">    NSURLRequest *request = [NSURLRequestrequestWithURL:url];</span><br><span class="line">    [self.webViewloadRequest:request];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//实现代理</span><br><span class="line">- (BOOL)webView:(nonnullUIWebView*)webView shouldStartLoadWithRequest:(nonnullNSURLRequest*)request </span><br><span class="line">                                                       navigationType:(UIWebViewNavigationType)navigationType &#123;</span><br><span class="line">    NSString *url = request.URL.absoluteString;</span><br><span class="line">    NSRange range = [url rangeOfString:@&quot;zcs://&quot;];</span><br><span class="line">    NSUInteger location = range.location;</span><br><span class="line"></span><br><span class="line">   if(location != NSNotFound) &#123;</span><br><span class="line"></span><br><span class="line">        //将url 处理得到方法名’btnClick&apos;</span><br><span class="line">        NSString*str = [url substringFromIndex:location + range.length];</span><br><span class="line"></span><br><span class="line">        //转换成方法,然后调用</span><br><span class="line">        SELsel = NSSelectorFromString(str);</span><br><span class="line">        [selfperformSelector:selwithObject:nil];</span><br><span class="line">    &#125; </span><br><span class="line">    return YES</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//实现方法</span><br><span class="line">-(void)btnClick &#123;</span><br><span class="line"></span><br><span class="line">    NSLog(@“我点,我点&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-JSExport-访问原生"><a href="#3-JSExport-访问原生" class="headerlink" title="3. JSExport 访问原生"></a>3. JSExport 访问原生</h2><h3 id="1-H5"><a href="#1-H5" class="headerlink" title="1. H5"></a>1. H5</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div style=&quot;margin-top: 20px&quot;&gt;</span><br><span class="line">        &lt;h2&gt;JS与OC交互&lt;/h2&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;唤起本地方法(call)&quot; onclick=&quot;ocObj.call()&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;唤起getCall:(NSString *)callString传值&quot; onclick=&quot;call()&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;script&gt;  </span><br><span class="line">    var call = function()</span><br><span class="line">    &#123;</span><br><span class="line">        var callInfo = JSON.stringify(&#123;&quot;baidu&quot;: &quot;http://www.baidu.com&quot;&#125;);</span><br><span class="line">        ocObj.getCall(callInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var Callback = function(str)</span><br><span class="line">    &#123;</span><br><span class="line">        alert(str);</span><br><span class="line">    &#125;</span><br><span class="line">    var alerCallback = function()</span><br><span class="line">    &#123;</span><br><span class="line">        alert(&apos;成功&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>上面html的代码：建立了两个button</p>
<ul>
<li>第一个button绑定了 ocObj.call() 方法</li>
</ul>
<p>这里 ocObj 是一个对象，这个对象的作用下面OC代码中会说明， ocObj.call() 代表 ocObj 对象调用 call() 方法</p>
<ul>
<li>第二个button绑定了 call() 的方法</li>
</ul>
<p>调用的是下面JavaScript中的 call() 方法，在 JavaScript 的 call() 里面，定义一个 callInfo 参数，<br>方法中 ocObj.getCall(callInfo) 代表 ocObj 对象调用 getCall 方法并传参数 callInfo </p>
<ul>
<li>下面两个方法是OC调用JavaScript方法，其中Callback传回str，alerCallback为OC仅调用JavaScript方法</li>
</ul>
<h3 id="2-OC代码"><a href="#2-OC代码" class="headerlink" title="2. OC代码"></a>2. OC代码</h3><p>demo采用原生的JavaScriptCore类</p>
<p>JSContext：给JavaScript提供运行的上下文环境<br>JSValue：JavaScript和Objective-C数据和方法的桥梁<br>JSExport：这是一个协议，如果采用协议的方法交互，自己定义的协议必须遵守此协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//导入头文件</span><br><span class="line">#import &lt;JavaScriptCore/JavaScriptCore.h&gt;</span><br><span class="line"></span><br><span class="line">@protocol JSObjcDelegate &lt;JSExport&gt;</span><br><span class="line"></span><br><span class="line">//ocObj对象调用的JavaScript方法，必须声明！！！</span><br><span class="line">- (void)call;</span><br><span class="line">- (void)getCall:(NSString *)callString;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface ViewController : UIViewController &lt;UIWebViewDelegate, JSObjcDelegate&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) JSContext *jsContext;</span><br><span class="line">@property (nonatomic, strong) UIWebView *webView;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>JavaScriptCore中web页面调用原生应用的方法可以用Delegate或Block两种方法，这里以代理为例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">self.webView = [[UIWebView alloc]initWithFrame:CGRectMake(0, </span><br><span class="line">                                                20, </span><br><span class="line">                                                [UIScreen mainScreen].bounds.size.width, </span><br><span class="line">                                                [UIScreen mainScreen].bounds.size.height)];</span><br><span class="line">self.webView.delegate = self;</span><br><span class="line">//从本地加载html文件</span><br><span class="line">NSString* path = [[NSBundle mainBundle] pathForResource:@&quot;index&quot; ofType:@&quot;html&quot;];</span><br><span class="line">NSURL* url = [NSURL fileURLWithPath:path];</span><br><span class="line">NSURLRequest* request = [NSURLRequest requestWithURL:url] ;</span><br><span class="line">[self.webView loadRequest:request];</span><br><span class="line"></span><br><span class="line">[self.view addSubview:self.webView];</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (void)webViewDidFinishLoad:(UIWebView *)webView &#123;</span><br><span class="line"></span><br><span class="line">    // 设置javaScriptContext上下文</span><br><span class="line">    self.jsContext = [webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];</span><br><span class="line">    </span><br><span class="line">    // JavaScript的ocObj是一个对象，充当原生应用和web页面之间的一个桥梁。用来调用方法</span><br><span class="line">    // 将ocObj对象指向自身</span><br><span class="line">    self.jsContext[@&quot;ocObj&quot;] = self;</span><br><span class="line">    self.jsContext.exceptionHandler = ^(JSContext *context, JSValue *exceptionValue) &#123;</span><br><span class="line">        context.exception = exceptionValue;</span><br><span class="line">        NSLog(@&quot;异常信息：%@&quot;, exceptionValue);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将对象指向自身后，如果调用 ocObj.call() 会响应下面的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// H5调用原生 并且 再由原生调用H5</span><br><span class="line">- (void)call &#123;</span><br><span class="line">    NSLog(@&quot;call&quot;);</span><br><span class="line"></span><br><span class="line">    JSValue *Callback = self.jsContext[@&quot;Callback&quot;];</span><br><span class="line">    [Callback callWithArguments:@[@&quot;唤起本地OC回调完成&quot;]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将对象指向自身后，如果调用 ocObj.getCall(callInfo) 会响应下面的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// H5调用原生 并且 再由原生调用H5</span><br><span class="line">- (void)getCall:(NSString *)callString&#123;</span><br><span class="line">    NSLog(@&quot;Get:%@&quot;, callString);</span><br><span class="line">    </span><br><span class="line">    JSValue *Callback = self.jsContext[@&quot;alerCallback&quot;];</span><br><span class="line">    [Callback callWithArguments:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将对象指向自身后，还可以向html注入js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (void)alert &#123;</span><br><span class="line"></span><br><span class="line">    // 直接添加提示框</span><br><span class="line">    NSString *str = @&quot;alert(&apos;OC添加JS提示成功&apos;)&quot;;</span><br><span class="line">    [self.jsContext evaluateScript:str];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="二-WKWebView"><a href="#二-WKWebView" class="headerlink" title="二. WKWebView"></a>二. WKWebView</h1><h2 id="1-WKUserContentController内容交互控制器"><a href="#1-WKUserContentController内容交互控制器" class="headerlink" title="1. WKUserContentController内容交互控制器"></a>1. WKUserContentController内容交互控制器</h2><p>WKUserContentController是用于给JS注入对象的，注入对象后，JS端就可以使用：<code>window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;)</code></p>
<p>H5调用发送数据给iOS端，比如：<br>window.webkit.messageHandlers.AppModel.postMessage({body: ‘js中调用OC’});<br>AppModel就是我们要注入的名称，注入以后，就可以在JS端调用了，传数据统一通过body传，可以是多种类型，只支持NSNumber, NSString, NSDate, NSArray,NSDictionary, and NSNull类型。 </p>
<p>我们要通过JS与webview内容交互，就需要到这个类了，它的所有属性及方法说明如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/ 只读属性，所有添加的WKUserScript都在这里可以获取到</span><br><span class="line">@property (nonatomic, readonly, copy) NSArray&lt;WKUserScript *&gt; *userScripts;</span><br><span class="line"></span><br><span class="line">// 注入JS</span><br><span class="line">- (void)addUserScript:(WKUserScript *)userScript;</span><br><span class="line"></span><br><span class="line">// 移除所有注入的JS</span><br><span class="line">- (void)removeAllUserScripts;</span><br><span class="line"></span><br><span class="line">// 添加scriptMessageHandler到所有的frames中，则都可以通过</span><br><span class="line">// window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;)</span><br><span class="line"></span><br><span class="line">// 发送消息</span><br><span class="line">// 比如，JS要调用我们原生的方法，就可以通过这种方式了</span><br><span class="line">- (void)addScriptMessageHandler:(id &lt;WKScriptMessageHandler&gt;)scriptMessageHandler name:(NSString *)name;</span><br><span class="line"></span><br><span class="line">// 根据name移除所注入的scriptMessageHandler</span><br><span class="line">- (void)removeScriptMessageHandlerForName:(NSString *)name;</span><br></pre></td></tr></table></figure>
<h2 id="2-给JS的-main-frame-注入-self-作为-js-对象，在js里它叫-AppModel"><a href="#2-给JS的-main-frame-注入-self-作为-js-对象，在js里它叫-AppModel" class="headerlink" title="2. 给JS的 main frame 注入 self 作为 js 对象，在js里它叫 AppModel"></a>2. 给JS的 main frame 注入 self 作为 js 对象，在js里它叫 AppModel</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">WKWebViewConfiguration *config = [[WKWebViewConfiguration alloc] init];</span><br><span class="line"></span><br><span class="line">// 设置偏好设置</span><br><span class="line">config.preferences = [[WKPreferences alloc] init];</span><br><span class="line">// 默认为0</span><br><span class="line">config.preferences.minimumFontSize = 10;</span><br><span class="line">// 默认认为YES</span><br><span class="line">config.preferences.javaScriptEnabled = YES;</span><br><span class="line">// 在iOS上默认为NO，表示不能自动通过窗口打开</span><br><span class="line">config.preferences.javaScriptCanOpenWindowsAutomatically = NO;</span><br><span class="line"></span><br><span class="line">// WKProcessPool并没有公开任何的属性或者方法，不需要配置：</span><br><span class="line">config.processPool = [[WKProcessPool alloc] init];</span><br><span class="line"></span><br><span class="line">config.userContentController = [[WKUserContentController alloc] init];</span><br><span class="line">[config.userContentController addScriptMessageHandler:self name: @&quot;AppModel&quot;];</span><br></pre></td></tr></table></figure>
<h2 id="3-当JS通过AppModel发送数据到iOS端"><a href="#3-当JS通过AppModel发送数据到iOS端" class="headerlink" title="3. 当JS通过AppModel发送数据到iOS端"></a>3. 当JS通过AppModel发送数据到iOS端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.webkit.messageHandlers.AppModel.postMessage(&#123;body: &apos;js中调用OC&apos;&#125;);</span><br></pre></td></tr></table></figure>
<p>在代理中收到：<br>所有JS调用iOS的部分，都只可以在此处使用哦。当然我们也可以注入多个名称（JS对象），用于区分功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - WKScriptMessageHandler</span><br><span class="line"></span><br><span class="line">- (void)userContentController:(WKUserContentController *)userContentController</span><br><span class="line">      didReceiveScriptMessage:(WKScriptMessage *) message &#123;</span><br><span class="line"></span><br><span class="line">    if ([message.name isEqualToString:@&quot;AppModel&quot;]) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-监听-WkWebView"><a href="#4-监听-WkWebView" class="headerlink" title="4. 监听 WkWebView"></a>4. 监听 WkWebView</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">self.webView = [[WkWebView alloc] initWithFrame:self.view.bounds</span><br><span class="line">                configuration:config];</span><br><span class="line"></span><br><span class="line">// NSURL * url = ... 你自己项目的URL</span><br><span class="line">[self.webView loadRequest: [NSURLRequest requestWithURL: url]];</span><br><span class="line">[self.view addSubview: self.webView];</span><br><span class="line"></span><br><span class="line">// 如果需要处理web导航条上的代理处理，比如链接是否可以跳转或者如何跳转，需要设置代理；</span><br><span class="line">// 而如果需要与在JS调用alert、confirm、prompt函数时，</span><br><span class="line">// 通过JS原生来处理，而不是调用JS的alert、confirm、prompt函数，</span><br><span class="line">// 那么需要设置UIDelegate，在得到响应后可以将结果反馈到JS端： </span><br><span class="line"></span><br><span class="line">self.webView.navigationDelegate = self;</span><br><span class="line">self.webView.UIDelegate = self;</span><br><span class="line"></span><br><span class="line">// 添加对WKWebView属性的监听</span><br><span class="line"></span><br><span class="line">[self.webView addObserver: self forKeyPath:@&quot;loading&quot; options:NSKeyValueObservingOptionsNew context:nil];</span><br><span class="line">[self.webView addObserver: self forKeyPath:@&quot;title&quot; options:NSKeyValueObservingOptionsNew context:nil];</span><br><span class="line">[self.webView addObserver: self forKeyPath:@&quot;estimatedProgress&quot; options:NSKeyValueObservingOptionsNew context:nil];</span><br><span class="line"></span><br><span class="line">// 然后我们就可以实现KVO处理方法，在loading完成时，可以注入一些JS到web中。</span><br><span class="line"></span><br><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context &#123;</span><br><span class="line"></span><br><span class="line">    if ([keyPath isEqualToString:@&quot;loading&quot;]) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; else if ([keyPath isEqualToString:@&quot;title&quot;]) &#123;</span><br><span class="line">        self.title = self.webView.title;</span><br><span class="line">    &#125; else if ([keyPath isEqualToString:@&quot;estimatedProgress&quot;]) &#123;</span><br><span class="line">        self.progressView.progress = self.webView.estimatedProgress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (self.webView.loading == NO) &#123;</span><br><span class="line"></span><br><span class="line">        NSString * jsStr = @&quot;callJsAlert();&quot;;</span><br><span class="line"></span><br><span class="line">        [self.webView evaluateHavaScript: jsStr completionHandler:^(id response, NSError * error) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;];</span><br><span class="line"></span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line"></span><br><span class="line">            self.progresView.alpha = 0;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-WKUIDelegate"><a href="#5-WKUIDelegate" class="headerlink" title="5. WKUIDelegate"></a>5. WKUIDelegate</h2><p>与JS原生的alert、confirm、prompt交互，将弹出来的实际上是我们原生的窗口，而不是JS的。在得到数据后，由原生传回到JS。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 创建新的webview</span><br><span class="line">// 可以指定配置对象、导航动作对象、window特性</span><br><span class="line">- (nullable WKWebView *)webView:(WKWebView *)webView createWebViewWithConfiguration:(WKWebViewConfiguration *)configuration forNavigationAction:(WKNavigationAction *)navigationAction windowFeatures:(WKWindowFeatures *)windowFeatures &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// webview关闭时回调</span><br><span class="line">- (void)webViewDidClose:(WKWebView *)webView NS_AVAILABLE(10_11, 9_0) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 调用JS的alert()方法</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">    // 自己写一个 UIAlertController 并弹出来</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 调用JS的confirm()方法</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(BOOL result))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">    // 自己写一个 UIAlertController 并弹出来</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 调用JS的prompt()方法</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(nullable NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString * __nullable result))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">    // 自己写一个 UIAlertController 并弹出来</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-WKNavigationDelegate"><a href="#6-WKNavigationDelegate" class="headerlink" title="6. WKNavigationDelegate"></a>6. WKNavigationDelegate</h2><p>如果需要处理web导航操作，比如链接跳转、接收响应、在导航开始、成功、失败等时要做些处理，就可以通过实现相关的代理方法： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, WKNavigationType) &#123;</span><br><span class="line">    // 链接已经点击</span><br><span class="line">    WKNavigationTypeLinkActivated,</span><br><span class="line">    // 表单提交</span><br><span class="line">    WKNavigationTypeFormSubmitted,</span><br><span class="line">    // 前进、后退</span><br><span class="line">    WKNavigationTypeBackForward,</span><br><span class="line">    // 重新载入</span><br><span class="line">    WKNavigationTypeReload,</span><br><span class="line">    // 表单重新提交</span><br><span class="line">    WKNavigationTypeFormResubmitted,</span><br><span class="line">    // 其它</span><br><span class="line">    WKNavigationTypeOther = -1,</span><br><span class="line">&#125; NS_ENUM_AVAILABLE(10_10, 8_0);</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, WKNavigationActionPolicy) &#123;</span><br><span class="line">    WKNavigationActionPolicyCancel,</span><br><span class="line">    WKNavigationActionPolicyAllow,</span><br><span class="line">&#125; NS_ENUM_AVAILABLE(10_10, 8_0);</span><br><span class="line"></span><br><span class="line">// 决定导航的动作，通常用于处理跨域的链接能否导航。WebKit对跨域进行了安全检查限制，不允许跨域，</span><br><span class="line">// 因此我们要对不能跨域的链接单独处理。但是，对于Safari是允许跨域的，不用这么处理。</span><br><span class="line">// 请求开始之前 会调用此方法 与 UIWebView 的 shouldStartLoadWithRequest 同理</span><br><span class="line">- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler &#123;</span><br><span class="line"></span><br><span class="line">    NSString * host = navigationAction.request.URL.host.lowercaseString();</span><br><span class="line">    if (navigationAction.navigationType == WKNavigationTypeLinkActivated </span><br><span class="line">        &amp;&amp; ![host containsString:@&quot;abc.com&quot;]) &#123;</span><br><span class="line">        // 跨域了不允许跳转 要由App跳转</span><br><span class="line">        [[UIApplication sharedApplication] canOpenURL:navigationAction.request.URL];</span><br><span class="line">        decisionHandler(WKNavigationActionPolicyCancel);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        self.progressVeiw.alpha = 1;</span><br><span class="line">        decisionHandler(WKNavigationActionPolicyAllow);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 决定是否接收响应</span><br><span class="line">// 这个是决定是否接收response</span><br><span class="line">// 要获取response，通过WKNavigationResponse对象获取</span><br><span class="line">- (void)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(void (^)(WKNavigationResponsePolicy))decisionHandler &#123;</span><br><span class="line"></span><br><span class="line">    decisionHandler(WKNavigationActionPolicyAllow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**************************** 其他的常用方法 ****************************/</span><br><span class="line"></span><br><span class="line">// 当main frame的导航开始请求时，会调用此方法</span><br><span class="line">- (void)webView:(WKWebView *)webView didStartProvisionalNavigation:(null_unspecified WKNavigation *)navigation;</span><br><span class="line"></span><br><span class="line">// 当main frame接收到服务重定向时，会回调此方法</span><br><span class="line">- (void)webView:(WKWebView *)webView didReceiveServerRedirectForProvisionalNavigation:(null_unspecified WKNavigation *)navigation;</span><br><span class="line"></span><br><span class="line">// 当main frame开始加载数据失败时，会回调</span><br><span class="line">- (void)webView:(WKWebView *)webView didFailProvisionalNavigation:(null_unspecified WKNavigation *)navigation withError:(NSError *)error;</span><br><span class="line"></span><br><span class="line">// 当main frame的web内容开始到达时，会回调</span><br><span class="line">- (void)webView:(WKWebView *)webView didCommitNavigation:(null_unspecified WKNavigation *)navigation;</span><br><span class="line"></span><br><span class="line">// 当main frame导航完成时，会回调</span><br><span class="line">- (void)webView:(WKWebView *)webView didFinishNavigation:(null_unspecified WKNavigation *)navigation;</span><br><span class="line"></span><br><span class="line">// 当main frame最后下载数据失败时，会回调</span><br><span class="line">- (void)webView:(WKWebView *)webView didFailNavigation:(null_unspecified WKNavigation *)navigation withError:(NSError *)error;</span><br><span class="line"></span><br><span class="line">// 这与用于授权验证的API，与AFN、UIWebView的授权验证API是一样的</span><br><span class="line">- (void)webView:(WKWebView *)webView didReceiveAuthenticationChallenge:(NSURLAuthenticationChallenge *)challenge completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition disposition, NSURLCredential *__nullable credential))completionHandler;</span><br><span class="line"></span><br><span class="line">// 当web content处理完成时，会回调 iOS9.0</span><br><span class="line">- (void)webViewWebContentProcessDidTerminate:(WKWebView *)webView NS_AVAILABLE(10_11, 9_0);</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/11/MJRefresh的思路/MJRefresh的思路/" rel="next" title="MJRefresh的思路">
                <i class="fa fa-chevron-left"></i> MJRefresh的思路
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars1.githubusercontent.com/u/12196768?s=400&u=8427ff12e9cdf05f9659b444385b2b5ee1663a18&v=4"
                alt="张春生" />
            
              <p class="site-author-name" itemprop="name">张春生</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zcs0843021123" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:1017295148@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#零-写在前边的话"><span class="nav-number">1.</span> <span class="nav-text">零. 写在前边的话</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一-UIWebView"><span class="nav-number">2.</span> <span class="nav-text">一. UIWebView</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-执行js语句"><span class="nav-number">2.1.</span> <span class="nav-text">1. 执行js语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-shouldStartLoadWithRequest-访问原生"><span class="nav-number">2.2.</span> <span class="nav-text">2. shouldStartLoadWithRequest 访问原生</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-JSExport-访问原生"><span class="nav-number">2.3.</span> <span class="nav-text">3. JSExport 访问原生</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-H5"><span class="nav-number">2.3.1.</span> <span class="nav-text">1. H5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-OC代码"><span class="nav-number">2.3.2.</span> <span class="nav-text">2. OC代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二-WKWebView"><span class="nav-number">3.</span> <span class="nav-text">二. WKWebView</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-WKUserContentController内容交互控制器"><span class="nav-number">3.1.</span> <span class="nav-text">1. WKUserContentController内容交互控制器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-给JS的-main-frame-注入-self-作为-js-对象，在js里它叫-AppModel"><span class="nav-number">3.2.</span> <span class="nav-text">2. 给JS的 main frame 注入 self 作为 js 对象，在js里它叫 AppModel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-当JS通过AppModel发送数据到iOS端"><span class="nav-number">3.3.</span> <span class="nav-text">3. 当JS通过AppModel发送数据到iOS端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-监听-WkWebView"><span class="nav-number">3.4.</span> <span class="nav-text">4. 监听 WkWebView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-WKUIDelegate"><span class="nav-number">3.5.</span> <span class="nav-text">5. WKUIDelegate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-WKNavigationDelegate"><span class="nav-number">3.6.</span> <span class="nav-text">6. WKNavigationDelegate</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2014 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张春生</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
